version: '3.8'

services:
  crawler:
    image: ghcr.io/tomato414941/web-search-crawler:latest
    container_name: web-search-crawler
    restart: unless-stopped
    environment:
      # Frontend Server の IP アドレスを設定してください
      - INDEXER_API_URL=http://${FRONTEND_IP}:8080/api/indexer/page
      - REDIS_URL=redis://${FRONTEND_IP}:6379
      - INDEXER_API_KEY=${INDEXER_API_KEY}

      # Crawler 設定
      - CONCURRENCY=${CONCURRENCY:-4}
      - MAX_DEPTH=${MAX_DEPTH:-3}

    # メモリ制限（オプション）
    mem_limit: 512m

    # ヘルスチェック（オプション）
    healthcheck:
      test: [ "CMD-SHELL", "pgrep -f crawler || exit 1" ]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
